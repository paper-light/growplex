---
import {
  PUBLIC_CHAT_WIDGET_DOMAIN,
  PUBLIC_CHAT_WIDGET_ID,
} from "astro:env/client";
---

<script
  src={`${PUBLIC_CHAT_WIDGET_DOMAIN}/scripts/chat-widget.js`}
  data-chat-id={PUBLIC_CHAT_WIDGET_ID}></script>

<script
  is:inline
  data-astro-rerun
  data-domain={PUBLIC_CHAT_WIDGET_DOMAIN}
  data-chat-id={PUBLIC_CHAT_WIDGET_ID}
>
  (function () {
    const { chatId, domain } = document.currentScript.dataset;
    function boot() {
      if (!window.ChatWidget) {
        console.log("no window.ChatWidget");
        return;
      }
      if (!window.ChatWidget._loaded) {
        console.log("no window.ChatWidget._loaded");
        window.ChatWidget.init({
          chatId,
          domain,
          initTheme: "light",
          color: "var(--color-yellow-500)",
        });
      } else {
        console.log("window.ChatWidget._loaded");
        window.ChatWidget.reload({
          chatId,
          domain,
          initTheme: "light",
          color: "var(--color-yellow-500)",
        });
      }
    }
    boot();
  })();
</script>
