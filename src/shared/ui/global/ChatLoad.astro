---
import {
  PUBLIC_CHAT_WIDGET_DOMAIN,
  PUBLIC_CHAT_WIDGET_ID,
} from "astro:env/client";
---

<script is:inline src={`${PUBLIC_CHAT_WIDGET_DOMAIN}/scripts/chat-widget.js`}
></script>

<script
  is:inline
  data-astro-rerun
  data-domain={PUBLIC_CHAT_WIDGET_DOMAIN}
  data-chat-id={PUBLIC_CHAT_WIDGET_ID}
>
  (function () {
    const { chatId, domain } = document.currentScript.dataset;

    const theme = document.documentElement.getAttribute("data-theme");
    const open = localStorage.getItem("chat-widget-open") === "true";

    if (!window.ChatWidget) return;
    window.ChatWidget.init({
      chatId,
      domain,
      listenTheme: true,
      initTheme: theme || "light",
      initOpen: open,
    });
  })();
</script>
